#pragma once

class MessageHandler {
private:
	static const int CRC_FEILD_LEN = 2;
	static const int NETID_FEILD_LEN = 1;
	static const int MSGLEN_FEILD_LEN = 1;
	static const int MSGTYP_FEILD_LEN = 1;

	static const int PACKET_MAX_SIZE = 32;
	static const int PAYLOAD_MAX_SIZE = PACKET_MAX_SIZE - CRC_FEILD_LEN - NETID_FEILD_LEN
												- MSGLEN_FEILD_LEN - MSGTYP_FEILD_LEN;

	// sizeof(Message)
	typedef struct {
		uint8_t netId;     // RX or TX NetId based on the TX/RX Flag
		uint8_t flags; //  | 1b ack | 1b handshake | 1b autoIDAllocate |
		uint16_t datStart; // A pointer to somewhere in the buffer
		uint16_t datLen;
		uint8_t crc[CRC_FEILD_LEN];
	} Message;

	typedef struct {
		bool isOccupied;
		bool TxRx;

		uint8_t numRetries;
		uint32_t rxTick;

		Message msg;
	} MessageHandle;

};



